<div class="w-full h-fit">
  <p class="text-2xl" data-tm="txt-popup-title">{{ isEditMode() ? 'Edit Task' : 'New Task' }}</p>
  <div class="w-full h-fit mt-3">
    <form [formGroup]="taskForm" (ngSubmit)="submit()" class="flex flex-col gap-4 w-full" data-tm="popup-form">

      <div class="w-full">
        <label class="mb-1 w-full">Title</label>
        <input formControlName="title" type="text" class="w-full border border-gray-200 p-2 rounded focus:outline-blue-200"
          [class.border-red-500]="taskForm.get('title')?.touched && taskForm.get('title')?.invalid"
           data-tm="input-title">
        @if (taskForm.get('title')?.touched && taskForm.get('title')?.hasError('required')) {
          <small class="text-red-500 w-full" data-tm="title-error">Title is required.</small>
        }
      </div>

      <div class="w-full">
        <label class="mb-1 w-full">Description</label>
        <textarea formControlName="description" class="w-full border border-gray-200 p-2 rounded focus:outline-blue-200" rows="3"
        [class.border-red-500]="taskForm.get('description')?.touched && taskForm.get('description')?.invalid"
        data-tm="input-desc"></textarea>
        @if (taskForm.get('description')?.touched && taskForm.get('description')?.hasError('required')) {
          <small class="text-red-500 w-full" data-tm="desc-error">Description is required.</small>
        }
      </div>

      @if (isEditMode()) {
      <div class="w-full">
        <label class="mb-1 w-full">Status</label>
        <select formControlName="status" class="w-full border border-gray-200 p-2 rounded focus:outline-blue-200"
        [class.border-red-500]="isEditMode() && taskForm.get('status')?.touched && taskForm.get('status')?.invalid"
        data-tm="status-selector">
          @for (status of statusOptions; track status) {
          <option [value]="status" [attr.data-tm]="`opt-${status}`">{{ status }}</option>
          }
        </select>
        @if (isEditMode() && taskForm.get('status')?.touched && taskForm.get('status')?.hasError('required')) {
          <small class="text-red-500 w-full" data-tm="status-error">Status is required.</small>
        }
      </div>
      }

      <div class="flex justify-end gap-2 mt-4 w-full">
        <button type="button" (click)="dialogService.close()" class="btn-default disabled:opacity-30"
        data-tm="btn-cancel">Cancel</button>
        <button type="submit" [disabled]="taskForm.invalid"
          class="btn-primary" data-tm="submit-btn">
          {{ isEditMode() ? 'Save' : 'Create' }}
        </button>
      </div>
    </form>
  </div>
</div>
